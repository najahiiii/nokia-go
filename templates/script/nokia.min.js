var NokiaApp=(()=>{var T=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var U=T(()=>{const h={baseUrl:`${window.location.origin}/api`,async fetchData(e,t=""){const n=`${this.baseUrl}/${e}${t?"?"+t:""}`,a=await fetch(n);if(!a.ok){let s=`HTTP error! status: ${a.status}`;try{const i=await a.json();i?.error&&(s=i.error)}catch{}throw new Error(s)}return await a.json()},async sendJSON(e,t,n="POST"){const a=await fetch(`${this.baseUrl}/${e}`,{method:n,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){let s=`HTTP error! status: ${a.status}`;try{const i=await a.json();i?.error&&(s=i.error)}catch{}throw new Error(s)}try{return await a.json()}catch{return{}}},getFormattedDailyUsage(){return this.fetchData("daily_usage")},getPreloginStatus(){return this.fetchData("prelogin_status")},getOverview(){return this.fetchData("overview")},getWanStatus(){return this.fetchData("wan_status")},getDeviceStatus(){return this.fetchData("device_status")},getNetworkClients(){return this.fetchData("network_clients")},getServiceData(){return this.fetchData("service_data")},getStatusWeb(){return this.fetchData("status_web")},getCurrentLedState(){return this.fetchData("led_state")},setLedState(e){return this.sendJSON("led_state",{enable:e})},setApnInternet(e){return this.fetchData("set_apn",`apn=${encodeURIComponent(e)}`)},doReboot(){return this.fetchData("do_reboot")},getLanStatus(){return this.fetchData("lan_status")},getWlan24gStatus(){return this.fetchData("wlan_configs_24g")},getWlan5gStatus(){return this.fetchData("wlan_configs_5g")},getSmsList(){return this.fetchData("sms")},setSmsState(e,t){return this.fetchData("set_sms_state",`smsid=${encodeURIComponent(e)}&smsunread=${encodeURIComponent(t)}`)},deleteSms(e,t={}){const a=(Array.isArray(e)?e:e===void 0?[]:[e]).map(i=>typeof i=="number"?String(i):(i??"").toString()).map(i=>i.trim()).filter(i=>i.length>0),s={};return a.length>0&&(s.sms_ids=a),t.deleteAll&&(s.delete_all=!0),!s.delete_all&&!s.sms_ids?Promise.reject(new Error("No SMS IDs provided")):this.sendJSON("delete_sms",s)},getCellularIdentity(){return this.fetchData("cell_identification")},getDataExpired(){return this.fetchData("get_data_expired")},setDataExpired(e){return this.fetchData("set_data_expired",`data_expired=${encodeURIComponent(e)}`)},getConfig(){return this.fetchData("config")},updateConfig(e){return this.sendJSON("config",e)},checkListener(e,t){const n=new URLSearchParams;return e!=null&&n.set("host",e),t!=null&&n.set("port",t),this.fetchData("config/listener_available",n.toString())}},m={escapeHtml(e){return e==null?"":String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},updateSignalBars(e){e=Math.max(0,Math.min(5,Math.floor(e))),document.querySelectorAll(".signal-bar").forEach((t,n)=>{const a=n<5-e;t.setAttribute("fill",a?"#666666":"#6495ed"),t.setAttribute("opacity",a?"0.4":"1")})},formatUptime(e){return[{value:86400,singular:"day",plural:"days"},{value:3600,singular:"hr",plural:"hrs"},{value:60,singular:"min",plural:"mins"},{value:1,singular:"sec",plural:"secs"}].reduce((n,a)=>{const s=Math.floor(e/a.value);return(s>0||n.length===0)&&(n.push(`${s} ${s===1?a.singular:a.plural}`),e%=a.value),n},[]).join(" ")},updateProgressBar(e,t,n,a,s=!1){const i=document.getElementById(e);if(!i)return;const r=Math.max(0,Math.min(100,(t-n)/(a-n)*100));i.style.width=`${r}%`;let o;s?o=r>75?"bg-red-500":r>45?"bg-yellow-500":"bg-green-500":o=r>75?"bg-green-500":r>45?"bg-yellow-500":"bg-red-500",i.className=`h-4 rounded-full transition-all duration-300 ${o}`},updateSignalStats(e){if(!e.cell_LTE_stats_cfg?.[0]?.stat)return;const t=e.cell_LTE_stats_cfg[0].stat;this.updateSignalBars(t.RSRPStrengthIndexCurrent),this.setTextContent("radioRSSI",`${t.RSSICurrent} dBm`),this.updateProgressBar("rssiProgress",t.RSSICurrent,-120,-30),this.setTextContent("radioRSRP",`${t.RSRPCurrent} dBm`),this.updateProgressBar("rsrpProgress",t.RSRPCurrent,-140,-64),this.setTextContent("radioSNR",`${t.SNRCurrent} dB`),this.updateProgressBar("sinrProgress",t.SNRCurrent,-10,30),this.setTextContent("radioRSRQ",`${t.RSRQCurrent} dBm`),this.updateProgressBar("rsrqProgress",t.RSRQCurrent,-20,-3)},updateNetworkInfo(e){if(e.ntwtopo_cfg?.[0]&&this.setTextContent("routerIp",e.ntwtopo_cfg[0].IPAddress),e.wan_conns?.[0]?.ipConns?.[0]&&this.setTextContent("wanIp",e.wan_conns[0].ipConns[0].ExternalIPAddress),e.wan_conns?.[0]?.ipConns?.[0]){const t=e.wan_conns[0].ipConns[0].DNSServers.split(" "),n=document.getElementById("dnsServer");n.innerHTML=`
                <span class="font-semibold text-xs">DNS Server</span>
                <div class="flex flex-col text-right">
                    ${t.map(a=>`<span class="font-semibold text-xs">${a}</span>`).join("")}
                </div>
            `}},updateDeviceStatus(e){const t=e.mem_info?.Total??1,n=e.mem_info?.Free??0,a=t-n;this.setTextContent("uptime",this.formatUptime(e.UpTime)),this.setTextContent("cpuUsage",`${e.cpu_usageinfo?.CPUUsage??"-"}%`),this.updateProgressBar("cpuUsageBar",e.cpu_usageinfo?.CPUUsage??0,0,100,!0),this.setTextContent("memUsage",`${Math.round(a/t*100)}%`),this.updateProgressBar("memUsageBar",a,0,t,!0)},setTextContent(e,t){const n=document.getElementById(e);n&&(n.textContent=t)},updateConnectedStatus(e){let t=0,n=0;for(const a of e.device_cfg)a.InterfaceType==="Ethernet"&&a.Active===1?t++:n++;document.getElementById("totalWiFiConnected").innerHTML=n,document.getElementById("totalLANConnected").innerHTML=t},updateLanStatus(e){const t=document.getElementById("deviceList");if(t.innerHTML="",!t)return;let n=[];for(const a of e.device_cfg){let s=a.MACAddress,i="OTHER";if(e.alias_cfg){for(const o of e.alias_cfg)if(o.MACAddress===a.MACAddress){s=o.HostName,i=o.DeviceCategory;break}}let r='<svg width="36" height="36" viewBox="0 0 56 57" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="56" height="56" rx="28" fill="var(--pure-color-primary-10)"></rect><path d="M50.4866 11.3203C41.2746 -1.09768 23.741 -3.69888 11.3202 5.51032C1.39976 12.8687 -2.25424 25.5387 1.36896 36.6687H54.6222C57.327 28.3471 56.0978 18.8859 50.4866 11.3203Z" fill="var(--pure-color-primary-20)"></path><path d="M1.36914 36.6687C2.28194 39.4715 3.65674 42.1791 5.51034 44.6795C14.7223 57.1003 32.2587 59.7015 44.6767 50.4895C49.5319 46.8887 52.8863 42.0139 54.6223 36.6715H1.36914V36.6687Z" fill="var(--pure-color-primary-10)"></path><path d="M20.8604 12.5999C20.8604 11.6721 21.6125 10.9199 22.5404 10.9199H43.8204C44.7482 10.9199 45.5004 11.6721 45.5004 12.5999V43.3999C45.5004 44.3278 44.7482 45.0799 43.8204 45.0799H22.5404C21.6125 45.0799 20.8604 44.3278 20.8604 43.3999V12.5999Z" fill="var(--pure-color-primary-90)"></path><path opacity="0.1" d="M30.3799 42.5851C30.3799 42.4143 30.5199 42.2771 30.6879 42.2771H35.5067C35.6775 42.2771 35.8147 42.4171 35.8147 42.5851C35.8147 42.7559 35.6747 42.8931 35.5067 42.8931H30.6879C30.5171 42.8903 30.3799 42.7559 30.3799 42.5851Z" fill="var(--pure-color-primary-10)"></path><path opacity="0.05" d="M20.8516 12.5803L20.79 40.7119L39.7376 10.9787L23.0748 10.9563C21.8372 10.9563 20.8516 11.6731 20.8516 12.5803Z" fill="var(--pure-color-primary-10)"></path><path opacity="0.1" d="M21.4199 45.08H27.8568C28.4506 45.08 28.9491 44.5672 28.9491 43.9627L28.9799 22.6944C28.9799 22.0699 28.4954 21.5771 27.8876 21.5771L21.4199 21.5772V45.08Z" fill="var(--pure-color-black)"></path><path d="M27.0143 45.1079L17.4719 45.0911C16.8643 45.0911 16.3799 44.6095 16.3799 43.9991L16.4107 23.2119C16.4107 22.6043 16.8951 22.1199 17.5027 22.1199L27.0451 22.1367C27.6527 22.1367 28.1371 22.6183 28.1371 23.2287L28.1063 44.0159C28.1063 44.6067 27.6079 45.1079 27.0143 45.1079Z" fill="var(--pure-color-primary-70)"></path><path opacity="0.1" d="M21.3691 23.7525C21.3691 23.6153 21.4811 23.5061 21.6155 23.5061H23.1023C23.2395 23.5061 23.3487 23.6181 23.3487 23.7525C23.3487 23.8897 23.2367 23.9989 23.1023 23.9989H21.6155C21.4811 23.9989 21.3691 23.8869 21.3691 23.7525Z" fill="var(--pure-color-primary-10)"></path><path opacity="0.03" d="M16.4615 23.268L16.4307 42.014L25.0547 22.1928L17.5535 22.176C16.9459 22.176 16.4615 22.6576 16.4615 23.268Z" fill="var(--pure-color-primary-10)"></path><path opacity="0.1" fill-rule="evenodd" clip-rule="evenodd" d="M14.2347 30.2791H18.3227C18.544 30.2791 18.726 30.4079 18.7792 30.6039L18.8949 33.6169C19.9503 34.3241 20.7424 35.4271 21.0278 36.7673C21.4951 38.9611 20.4594 41.1201 18.6181 42.1753L18.53 44.7886C18.4936 44.9734 18.3228 45.1134 18.1128 45.1134H14.2292C14.0192 45.1134 13.8484 44.9846 13.798 44.7886L13.704 42.2231C12.4512 41.5403 11.4917 40.3348 11.1714 38.8325C10.6943 36.5924 11.7821 34.3889 13.6974 33.3594L13.7952 30.6039C13.8344 30.4191 14.0135 30.2791 14.2347 30.2791Z" fill="var(--pure-color-black)"></path><path d="M13.3957 30.2791H17.4837C17.7049 30.2791 17.8869 30.4079 17.9401 30.6039L18.1221 35.3415H12.7881L12.9561 30.6039C12.9953 30.4191 13.1745 30.2791 13.3957 30.2791Z" fill="var(--pure-color-primary-40)"></path><path d="M17.2736 45.1022H13.39C13.18 45.1022 13.0092 44.9734 12.9588 44.7774L12.7852 40.0398H17.8504L17.6908 44.7774C17.6544 44.9622 17.4836 45.1022 17.2736 45.1022Z" fill="var(--pure-color-primary-40)"></path><path d="M16.2905 42.3052C18.8105 41.7732 20.4205 39.2784 19.8829 36.7332C19.3453 34.188 16.8673 32.5584 14.3445 33.0904C11.8217 33.6224 10.2145 36.1172 10.7521 38.6624C11.2897 41.2048 13.7705 42.8372 16.2905 42.3052Z" fill="var(--pure-color-primary-90)"></path><path opacity="0.03" d="M14.3474 33.0904C11.8246 33.6224 10.2174 36.1172 10.755 38.6624C10.9986 39.8216 11.6482 40.7932 12.5218 41.454L17.251 33.418C16.3718 33.012 15.361 32.8748 14.3474 33.0904Z" fill="var(--pure-color-primary-10)"></path></svg>';i=="SERVER"&&(r='<svg width="36" height="36" viewBox="0 0 56 57" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="56" height="56" rx="28" fill="var(--pure-color-primary-20)"></rect><path d="M50.4866 11.3204C41.2746 -1.09756 23.741 -3.69876 11.3202 5.51044C1.39976 12.8688 -2.25424 25.5388 1.36896 36.6688H54.6222C57.327 28.3472 56.0978 18.886 50.4866 11.3204Z" fill="var(--pure-color-primary-20)"></path><path d="M1.36914 36.6688C2.28194 39.4716 3.65674 42.1792 5.51034 44.6796C14.7223 57.1004 32.2587 59.7016 44.6767 50.4896C49.5319 46.8888 52.8863 42.014 54.6223 36.6716H1.36914V36.6688Z" fill="var(--pure-color-primary-10)"></path><path d="M39.2505 10.92C39.6866 10.92 40.04 11.4762 40.04 12.1622L40.04 43.8379C40.04 44.5239 39.6866 45.08 39.2505 45.08L16.7495 45.08C16.3135 45.08 15.96 44.5239 15.96 43.8379L15.96 12.1622C15.96 11.4762 16.3135 10.92 16.7495 10.92L39.2505 10.92Z" fill="var(--pure-color-primary-70)"></path><path d="M37.8799 21.4241C37.8799 21.6538 37.6558 21.8401 37.3795 21.8401L18.7001 21.8401C18.4237 21.8401 18.1997 21.6538 18.1997 21.4241L18.1997 18.6161C18.1997 18.3863 18.4237 18.2001 18.7001 18.2001L37.3795 18.2001C37.6558 18.2001 37.8799 18.3863 37.8799 18.6161L37.8799 21.4241Z" fill="var(--pure-color-primary-100)"></path><path d="M37.8799 27.3041C37.8799 27.5338 37.6558 27.7201 37.3795 27.7201L18.7001 27.7201C18.4237 27.7201 18.1997 27.5338 18.1997 27.3041L18.1997 24.4961C18.1997 24.2663 18.4237 24.0801 18.7001 24.0801L37.3795 24.0801C37.6558 24.0801 37.8799 24.2663 37.8799 24.4961L37.8799 27.3041Z" fill="var(--pure-color-primary-100)"></path><path d="M37.8799 33.1841C37.8799 33.4138 37.6558 33.6001 37.3795 33.6001L18.7001 33.6001C18.4237 33.6001 18.1997 33.4138 18.1997 33.1841L18.1997 30.3761C18.1997 30.1463 18.4237 29.9601 18.7001 29.9601L37.3795 29.9601C37.6558 29.9601 37.8799 30.1463 37.8799 30.3761L37.8799 33.1841Z" fill="var(--pure-color-primary-100)"></path><path d="M37.8799 39.0641C37.8799 39.2939 37.6558 39.4801 37.3795 39.4801L18.7001 39.4801C18.4237 39.4801 18.1997 39.2939 18.1997 39.0641L18.1997 36.2561C18.1997 36.0264 18.4237 35.8401 18.7001 35.8401L37.3795 35.8401C37.6558 35.8401 37.8799 36.0264 37.8799 36.2561L37.8799 39.0641Z" fill="var(--pure-color-primary-100)"></path><path d="M37.7998 15.26C37.7998 15.8013 37.3611 16.24 36.8198 16.24C36.2786 16.24 35.8398 15.8013 35.8398 15.26C35.8398 14.7188 36.2786 14.28 36.8198 14.28C37.3611 14.28 37.7998 14.7188 37.7998 15.26Z" fill="var(--pure-color-primary-10)"></path></svg>'),n.push(`
                <div role="listitem" class="flex items-center gap-3 py-3 border-b border-gray-600 last:border-b-0">
                    <div aria-hidden="true" class="bg-[#333] rounded-full w-9 h-9 flex justify-center items-center text-gray-400 text-lg">
                        ${r}
                    </div>
                    <div>
                        <div class="font-semibold text-sm text-[#e5e5e5]">${s}</div>
                        <div class="text-xs text-[#c8c8c8] flex items-center gap-1">
                            <span aria-hidden="true" class="w-2 h-2 rounded-full block bg-[#2e7d32]"></span>
                            ${a.IPAddress}
                        </div>
                    </div>
                    <div aria-label="WAN IP" class="font-bold text-xs text-[#e5e5e5] ml-auto">
                        ${i}
                    </div>
                </div>
            `)}t.insertAdjacentHTML("beforeend",n.join(""))},updateWlanStatus(e){const t=document.getElementById("wlanList");if(t.innerHTML="",e?.wlan_config_glb?.[0]){const n=e.wlan_config_glb[0],a=n.Enable?"checked":"",s=`
                <div class="relative cursor-pointer mb-3">
                    <div aria-label="WiFi network ${n.SSID}, Home Network - 2.4 GHz"
                         class="bg-[#333] rounded-xl p-3.5 font-semibold text-sm text-[#EDEDED] w-full pr-12">
                        ${n.SSID}
                        <div class="font-normal text-xs text-[#EDEDED] mt-1">
                            Home Network - 2.4 GHz
                        </div>
                    </div>
                    <label class="absolute right-3 top-1/2 -translate-y-1/2 w-9 h-5 cursor-pointer">
                        <input type="checkbox" ${a} class="sr-only peer">
                        <div class="relative w-9 h-5 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"></div>
                    </label>
                </div>`;t.insertAdjacentHTML("beforeend",s)}if(e?.wlan_config_glb11ac?.[0]){const n=e.wlan_config_glb11ac[0],a=n.Enable?"checked":"",s=`
                <div class="relative cursor-pointer mb-3">
                    <div aria-label="WiFi network ${n.SSID}, Home Network - 5 GHz"
                         class="bg-[#333] rounded-xl p-3.5 font-semibold text-sm text-[#EDEDED] w-full pr-12">
                        ${n.SSID}
                        <div class="font-normal text-xs text-[#EDEDED] mt-1">
                            Home Network - 5 GHz
                        </div>
                    </div>
                    <label class="absolute right-3 top-1/2 -translate-y-1/2 w-9 h-5 cursor-pointer">
                        <input type="checkbox" ${a} class="sr-only peer">
                        <div class="relative w-9 h-5 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"></div>
                    </label>
                </div>`;t.insertAdjacentHTML("beforeend",s)}},updateStatusWeb(e){e.cell_LTE_stats_cfg?.[0]&&(this.setTextContent("mainBand",e.cell_LTE_stats_cfg[0].stat.Band),this.setTextContent("mainPci",e.cell_LTE_stats_cfg[0].stat.PhysicalCellID),this.setTextContent("mainEarfcn",e.cell_LTE_stats_cfg[0].stat.DownlinkEarfcn),this.setTextContent("mainEci",e.cell_LTE_stats_cfg[0].stat.ECI))},updateServiceInfo(e){const t=document.getElementById("downlink"),n=document.getElementById("uplink");if(t.innerHTML="",n.innerHTML="",e?.FunctionResult?.LTEDLCA){const a=Array.isArray(e.FunctionResult.LTEDLCA)?e.FunctionResult.LTEDLCA:Object.values(e.FunctionResult.LTEDLCA);a.forEach((s,i)=>{const r=`
                    <div class="carrier-section mb-4">
                        <div class="flex justify-between py-1 mb-2">
                            <span class="font-semibold text-xs">Band</span>
                            <span class="font-semibold text-xs">${s.ScellBand||"N/A"}</span>
                        </div>
                        <div class="flex justify-between py-1 mb-2">
                            <span class="font-semibold text-xs">Bandwidth</span>
                            <span class="font-semibold text-xs">${s.ScellBandwidth||"N/A"}</span>
                        </div>
                        <div class="flex justify-between py-1 mb-2">
                            <span class="font-semibold text-xs">PCI</span>
                            <span class="font-semibold text-xs">${s.PhysicalCellID||"N/A"}</span>
                        </div>
                        <div class="flex justify-between py-1 mb-2">
                            <span class="font-semibold text-xs">EARFCN</span>
                            <span class="font-semibold text-xs">${s.ScellChannel||"N/A"}</span>
                        </div>
                        ${i<a.length-1?'<hr class="border-t border-gray-600 mb-3">':""}
                    </div>
                `;t.insertAdjacentHTML("beforeend",r)})}if(e?.FunctionResult?.LTEULCA){const a=Array.isArray(e.FunctionResult.LTEULCA)?e.FunctionResult.LTEULCA:Object.values(e.FunctionResult.LTEULCA);a.forEach((s,i)=>{const r=`
                    <div class="carrier-section mb-4">
                        <div class="flex justify-between py-1 mb-2">
                            <span class="font-semibold text-xs">Band</span>
                            <span class="font-semibold text-xs">${s.ScellBand||"N/A"}</span>
                        </div>
                        <div class="flex justify-between py-1 mb-2">
                            <span class="font-semibold text-xs">Bandwidth</span>
                            <span class="font-semibold text-xs">${s.ScellBandwidth||"N/A"}</span>
                        </div>
                        <div class="flex justify-between py-1 mb-2">
                            <span class="font-semibold text-xs">PCI</span>
                            <span class="font-semibold text-xs">${s.PhysicalCellID||"N/A"}</span>
                        </div>
                        <div class="flex justify-between py-1 mb-2">
                            <span class="font-semibold text-xs">EARFCN</span>
                            <span class="font-semibold text-xs">${s.ScellChannel||"N/A"}</span>
                        </div>
                        ${i<a.length-1?'<hr class="border-t border-gray-600 mb-3">':""}
                    </div>
                `;n.insertAdjacentHTML("beforeend",r)})}},updateCellularIdentity(e){this.setTextContent("radio-access-title",e?.FunctionResult?.Name??"Radio Access")},renderDailyUsageChart(e){const t=document.querySelector("#dailyUsageChart");if(!t)return;t.innerHTML="";const n=document.createElementNS("http://www.w3.org/2000/svg","svg");if(n.setAttribute("viewBox","0 0 100 100"),n.setAttribute("class","w-full h-auto max-w-[200px] mx-auto"),e.last_7_days.length===1){const l=e.last_7_days[0],y="#3B82F6",f=document.createElementNS("http://www.w3.org/2000/svg","circle");f.setAttribute("cx","50"),f.setAttribute("cy","50"),f.setAttribute("r","45"),f.setAttribute("fill",y),f.setAttribute("stroke","#444"),f.setAttribute("stroke-width","0.5"),f.setAttribute("class","transition-all duration-300 hover:opacity-80"),f.setAttribute("data-date",l.date),f.setAttribute("data-usage",l.combined.formatted),f.addEventListener("mouseenter",S=>{const D=document.createElement("div");D.className="absolute bg-[#333] p-2 rounded shadow-lg text-xs z-10 border border-gray-600",D.innerHTML=`
                    <strong class="text-white">${l.date}</strong><br>
                    <span class="text-blue-400">\u2191 ${l.upload.formatted}</span><br>
                    <span class="text-green-400">\u2193 ${l.download.formatted}</span><br>
                    <strong class="text-white">Total: ${l.combined.formatted}</strong><br>
                    100%
                `,D.style.top=`${S.clientY-60}px`,D.style.left=`${S.clientX}px`,D.id="chart-tooltip",document.body.appendChild(D)}),f.addEventListener("mouseleave",()=>{const S=document.getElementById("chart-tooltip");S&&S.remove()}),n.appendChild(f);const C=document.createElementNS("http://www.w3.org/2000/svg","text");C.setAttribute("x","50"),C.setAttribute("y","50"),C.setAttribute("text-anchor","middle"),C.setAttribute("dominant-baseline","middle"),C.setAttribute("class","text-sm font-bold fill-gray-300"),n.appendChild(C);const v=document.createElement("div");v.className="flex flex-wrap justify-center gap-2 mt-4";const E=document.createElement("div");E.className="flex items-center text-xs";const b=document.createElement("div");b.className="w-3 h-3 rounded-full mr-1",b.style.backgroundColor=y;const B=document.createElement("span");B.className="text-gray-300",B.textContent=new Date(l.date).toLocaleDateString("id-ID",{month:"short",day:"numeric"}),E.appendChild(b),E.appendChild(B),v.appendChild(E),t.appendChild(n),t.appendChild(v);return}const a=e.last_7_days.reduce((l,y)=>l+y.combined.raw_bytes,0);let s=0;const i=["#A29BFE","#FF8C94","#FFB266","#2EE59D","#4FC3F7","#FF6F61","#FFD54F"],r=e.last_7_days.map(l=>l.combined.raw_bytes/a*100||0),o=1,d=r.some(l=>l<o&&l>0),c=d?r.map(l=>Math.max(l,o)):r,p=c.reduce((l,y)=>l+y,0),u=c.map(l=>l/p*100);e.last_7_days.forEach((l,y)=>{const f=u[y],C=r[y],v=document.createElementNS("http://www.w3.org/2000/svg","path"),E=Math.max(f,.1),b=50+45*Math.cos(2*Math.PI*s/100),B=50+45*Math.sin(2*Math.PI*s/100);s+=E;const S=50+45*Math.cos(2*Math.PI*s/100),D=50+45*Math.sin(2*Math.PI*s/100),_=E>50?1:0,M=["M 50 50",`L ${b} ${B}`,`A 45 45 0 ${_} 1 ${S} ${D}`,"Z"].join(" ");v.setAttribute("d",M),v.setAttribute("fill",i[y%i.length]),v.setAttribute("stroke","#444"),v.setAttribute("stroke-width","0.5"),v.setAttribute("class","transition-all duration-300 hover:opacity-80"),v.setAttribute("data-date",l.date),v.setAttribute("data-usage",l.combined.formatted),v.addEventListener("mouseenter",L=>{const I=document.createElement("div");I.className="absolute bg-[#333] p-2 rounded shadow-lg text-xs z-10 border border-gray-600",I.innerHTML=`
                    <strong class="text-white">${l.date}</strong><br>
                    <span class="text-blue-400">\u2191 ${l.upload.formatted}</span><br>
                    <span class="text-green-400">\u2193 ${l.download.formatted}</span><br>
                    <strong class="text-white">Total: ${l.combined.formatted}</strong><br>
                    ${C.toFixed(1)}%${d?"*":""}
                `,I.style.top=`${L.clientY-60}px`,I.style.left=`${L.clientX}px`,I.id="chart-tooltip",document.body.appendChild(I)}),v.addEventListener("mouseleave",()=>{const L=document.getElementById("chart-tooltip");L&&L.remove()}),n.appendChild(v)});const g=document.createElementNS("http://www.w3.org/2000/svg","text");g.setAttribute("x","50"),g.setAttribute("y","50"),g.setAttribute("text-anchor","middle"),g.setAttribute("dominant-baseline","middle"),g.setAttribute("class","text-sm font-bold fill-gray-300"),n.appendChild(g),t.appendChild(n);const x=document.createElement("div");if(x.className="flex flex-wrap justify-center gap-2 mt-4",e.last_7_days.forEach((l,y)=>{const f=document.createElement("div");f.className="flex items-center text-xs";const C=document.createElement("div");C.className="w-3 h-3 rounded-full mr-1",C.style.backgroundColor=i[y%i.length];const v=document.createElement("span");v.className="text-gray-300",v.textContent=new Date(l.date).toLocaleDateString("id-ID",{month:"short",day:"numeric"}),v.textContent+=` (${l.combined.formatted})`,f.appendChild(C),f.appendChild(v),x.appendChild(f)}),d){const l=document.createElement("div");l.className="text-xs text-gray-400 mt-2 text-center",l.textContent="* Small values are exaggerated for visibility",t.appendChild(l)}t.appendChild(x)},updateSms(e){if(!e?.FunctionResult?.SMSList)return;const t=e.FunctionResult.SMSList,n=t.filter(d=>d.SMSUnread).length,a=document.getElementById("smsBadge");n>0?(a.textContent=n,a.classList.remove("hidden")):a.classList.add("hidden");const s=this.smsData||[],i=new Set(s.map(d=>d.SMSID)),r=t.filter(d=>!i.has(d.SMSID));if(this.smsData=t,r.length>0){const d=p=>{const u=p.SMSSender||"Unknown";let x=(p.SMSContent||"").trim();return x.length>80&&(x=`${x.slice(0,77)}\u2026`),x?`${u}: ${x}`:`From ${u}`},c=r.length===1?d(r[0]):`${r.length} new messages`;w.showNotification({title:"New SMS received",message:c,tone:"info"})}document.getElementById("smsDialog")?.classList.contains("active")&&$()}};function A(e,t,{loadingText:n="Processing\u2026",spinnerColor:a="text-white"}={}){if(e)if(t){e.dataset.defaultContent||(e.dataset.defaultContent=e.innerHTML);const s=m.escapeHtml(n);e.disabled=!0,e.setAttribute("aria-busy","true"),e.innerHTML=`
            <span class="inline-flex items-center gap-2">
                <svg class="h-4 w-4 animate-spin ${a}" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span>${s}</span>
            </span>
        `}else e.disabled=!1,e.removeAttribute("aria-busy"),e.dataset.defaultContent&&(e.innerHTML=e.dataset.defaultContent)}const w={async init(){this.initConfigDialog(),this.initNotifications(),this.initConnectedDevicesModal();try{await this.loadData(),await this.loadDailyUsage();const e=await h.getWlan24gStatus(),t=await h.getWlan5gStatus(),n={wlan_config_glb:e?.wlan_config_glb,wlan_config_glb11ac:t?.wlan_config_glb11ac};m.updateWlanStatus(n),F.init()}catch(e){console.error("Initialization error:",e)}this.startPolling(1e3)},async loadData(){const e=await h.getPreloginStatus(),t=await h.getStatusWeb(),n=await h.getServiceData(),a=await h.getDeviceStatus(),s=await h.getSmsList();m.updateSignalStats(e),m.updateNetworkInfo(e),m.updateConnectedStatus(e),m.updateLanStatus(e),m.updateStatusWeb(t),m.updateServiceInfo(n),m.updateDeviceStatus(a),m.updateSms(s)},async loadDailyUsage(){const e=await h.getCellularIdentity(),t=await h.getFormattedDailyUsage();m.updateCellularIdentity(e),m.renderDailyUsageChart(t),document.getElementById("cellTotalDl").textContent=t?.last_7_days?.[0]?.download?.formatted||"0 B",document.getElementById("cellTotalUl").textContent=t?.last_7_days?.[0]?.upload?.formatted||"0 B",document.getElementById("totalUsage").textContent=t?.total_usage?.combined||"0 B"},initConfigDialog(){if(this.configDialog=document.getElementById("configDialog"),!this.configDialog)return;this.configForm=document.getElementById("configForm"),this.configSaveBtn=document.getElementById("configSaveBtn"),this.configCancelBtn=document.getElementById("configCancelBtn"),this.configInputs={routerHost:document.getElementById("configRouterHost"),routerUser:document.getElementById("configRouterUser"),routerPassword:document.getElementById("configRouterPassword"),listenHost:document.getElementById("configListenHost"),listenPort:document.getElementById("configListenPort")};const e=document.getElementById("configIcon"),t=document.getElementById("configCloseDialog");e?.addEventListener("click",()=>this.openConfigDialog()),t?.addEventListener("click",()=>this.closeConfigDialog()),this.configCancelBtn?.addEventListener("click",()=>this.closeConfigDialog()),this.configForm?.addEventListener("submit",n=>this.submitConfigForm(n))},initNotifications(){if(this.notificationRoot=document.getElementById("notificationRoot"),this.notificationRoot&&!this.notificationRoot.querySelector(".toast-container")){const e=document.createElement("div");e.className="toast-container pointer-events-auto",this.notificationRoot.appendChild(e)}},initConnectedDevicesModal(){this.connectedDevices={modal:document.getElementById("connectedDevicesModal"),trigger:document.getElementById("connectedDevicesViewAll"),closeBtn:document.getElementById("connectedDevicesClose"),loading:document.getElementById("connectedDevicesLoading"),error:document.getElementById("connectedDevicesError"),content:document.getElementById("connectedDevicesContent"),summary:document.getElementById("connectedDevicesSummary"),ethernetList:document.getElementById("connectedEthernetList"),ethernetEmpty:document.getElementById("connectedEthernetEmpty"),ethernetCount:document.getElementById("connectedEthernetCount"),wifiList:document.getElementById("connectedWifiList"),wifiEmpty:document.getElementById("connectedWifiEmpty"),wifiCount:document.getElementById("connectedWifiCount")};const{trigger:e,closeBtn:t,modal:n}=this.connectedDevices??{};!n||!e||(e.addEventListener("click",a=>{a.preventDefault(),this.openConnectedDevicesModal()}),e.addEventListener("keydown",a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),this.openConnectedDevicesModal())}),t?.addEventListener("click",()=>this.closeConnectedDevicesModal()),n.addEventListener("click",a=>{a.target===n&&this.closeConnectedDevicesModal()}),document.addEventListener("keydown",a=>{a.key==="Escape"&&n.classList.contains("active")&&this.closeConnectedDevicesModal()}))},async openConnectedDevicesModal(){const e=this.connectedDevices?.modal;e&&(e.classList.add("active"),await this.refreshConnectedDevicesModal())},closeConnectedDevicesModal(){const e=this.connectedDevices?.modal;e&&e.classList.remove("active")},toggleConnectedDevicesLoading(e){const t=this.connectedDevices?.loading;t&&t.classList.toggle("hidden",!e)},toggleConnectedDevicesContent(e){const t=this.connectedDevices?.content;t&&t.classList.toggle("hidden",!e)},showConnectedDevicesError(e){const t=this.connectedDevices?.error;t&&(e?(t.textContent=e,t.classList.remove("hidden")):(t.textContent="",t.classList.add("hidden")))},async refreshConnectedDevicesModal(){if(this.connectedDevices?.modal){this.toggleConnectedDevicesLoading(!0),this.toggleConnectedDevicesContent(!1),this.showConnectedDevicesError("");try{const e=await h.getNetworkClients();this.connectedDevicesData=e;const t=this.parseNetworkClients(e);this.renderConnectedDevices(t),this.toggleConnectedDevicesContent(!0)}catch(e){console.error("Failed to load network clients:",e),this.showConnectedDevicesError(e.message||"Failed to load connected devices.")}finally{this.toggleConnectedDevicesLoading(!1)}}},parseNetworkClients(e){const t={ethernet:[],wifi:[],aps:[],radios:[],capabilities:this.extractCapabilities(e?.network?.clients?.capabilities),raw:e};return(Array.isArray(e?.aps)?e.aps:[]).forEach(a=>{const s=this.unwrapSingleEntry(a);if(!s)return;const i=this.normalizeMacAddress(s["mac-address"]),r=i||s["router-id-str"]||String(s["router-id"]||""),o={key:r,routerId:s["router-id-str"]||s["router-id"]||"",hostname:s.hostname||"Access point",ip:s["ip-address"]||"",mac:i,software:s["software-version"]||"",uptime:typeof s["uptime-sec"]=="number"?s["uptime-sec"]:this.coerceNumber(s["uptime-sec"])};t.aps.push(o),(Array.isArray(s["ethernet-clients"])?s["ethernet-clients"]:[]).forEach(p=>{const u=this.unwrapSingleEntry(p);if(!u)return;const g=this.normalizeMacAddress(u["mac-address"]||Object.keys(p||{})[0]);if(!g)return;const x=this.coerceNumber(u["phy-rate"]),l=this.coerceNumber(u["port-number"]);t.ethernet.push({type:"Ethernet",mac:g,name:u["host-name"]||u.hostname||"",ip:u["ip-address"]||u["ipv4-address"]||"",port:Number.isFinite(l)?l:null,phyRate:Number.isFinite(x)?x:null,vendor:u.vendor,ap:o,apKey:r,raw:u})}),(Array.isArray(s.radios)?s.radios:[]).forEach(p=>{const u=this.unwrapSingleEntry(p);if(!u)return;const g={id:this.normalizeMacAddress(u["radio-id"]||u["mac-address"])||"",medium:u.medium||"",band:u.band||u["band-type"]||u["frequency-band"]||this.mediumToBand(u.medium),standard:u["wifi-standard"]||"",channel:this.coerceNumber(u.channel??u["channel-number"]),metrics:u.metrics||{},ap:o,apKey:r};t.radios.push(g),(Array.isArray(u.ssids)?u.ssids:[]).forEach(l=>{const y=this.unwrapSingleEntry(l);if(!y)return;const f=y.ssid||"",C=this.normalizeMacAddress(y.bssid||g.id);(Array.isArray(y.clients)?y.clients:[]).forEach(E=>{const b=this.unwrapSingleEntry(E);if(!b)return;const B=b["mac-address"]||Object.keys(E||{})[0],S=this.normalizeMacAddress(B);if(!S)return;const D=b.metrics||{},_=b["ewma-metrics"]||{},M=b["sensing-data"]||{},L=b.stats||{},I=b.capabilities||{};t.wifi.push({type:"WiFi",mac:S,name:b["host-name"]||b.hostname||b["device-name"]||"",ip:b["ip-address"]||b["ipv4-address"]||"",rssiDbm:this.coerceNumber(M["rssi-dbm"]),signalStrength:this.coerceNumber(D["signal-strength"]??_["signal-strength"]??M.metric),downRateKbps:this.coerceNumber(D["last-data-dl-rate"]??_["last-data-dl-rate"]??M["data-rate-rx-kbps"]),upRateKbps:this.coerceNumber(D["last-data-ul-rate"]??_["last-data-ul-rate"]??M["data-rate-tx-kbps"]),phyRate:this.coerceNumber(b["phy-rate"]??b["link-rate"]),band:g.band,medium:g.medium,standard:g.standard,channel:g.channel,ssid:f,bssid:C,vendor:b.vendor,state:b.state,txBytes:this.coerceNumber(L["total-tx-bytes"]),rxBytes:this.coerceNumber(L["total-rx-bytes"]),secondsSinceSeen:this.coerceNumber(M["seconds-since-seen"]),connectedSeconds:this.coerceNumber(b["connected-time"]??b["connection-time"]),capabilities:I,ap:o,apMac:o.mac,apKey:r,raw:b})})})})}),t},unwrapSingleEntry(e){if(!e||typeof e!="object"||Array.isArray(e))return null;const t=Object.keys(e);if(t.length===1){const n=e[t[0]];if(n&&typeof n=="object"&&!Array.isArray(n))return n}return e},normalizeMacAddress(e){if(!e)return"";const t=String(e).trim();if(!t)return"";const n=t.replace(/[^0-9a-fA-F]/g,"");return n.length===12?n.match(/.{1,2}/g).join(":").toUpperCase():t.toUpperCase()},extractCapabilities(e){return!e||typeof e!="object"?[]:Object.entries(e).filter(([,t])=>t===!0||t==="true"||t===1||t==="1").map(([t])=>this.formatCapabilityLabel(t))},formatCapabilityLabel(e){if(!e)return"";const t={"capable-24ghz-csa":"2.4 GHz CSA","capable-24ghz-ecsa":"2.4 GHz eCSA","capable-24ghz-mimo":"2.4 GHz MIMO","capable-24ghz-n":"2.4 GHz 802.11n","capable-24ghz-rx-streams":"2.4 GHz RX Streams","capable-24ghz-tx-streams":"2.4 GHz TX Streams","capable-5ghz-csa":"5 GHz CSA","capable-5ghz-ecsa":"5 GHz eCSA","capable-5ghz-mimo":"5 GHz MIMO","capable-5ghz-ac":"5 GHz 802.11ac","capable-5ghz-n":"5 GHz 802.11n","capable-5ghz-rx-streams":"5 GHz RX Streams","capable-5ghz-tx-streams":"5 GHz TX Streams","capable-6ghz":"6 GHz capable","capable-6ghz-csa":"6 GHz CSA","capable-6ghz-ecsa":"6 GHz eCSA","capable-6ghz-mimo":"6 GHz MIMO","capable-6ghz-rx-streams":"6 GHz RX Streams","capable-6ghz-tx-streams":"6 GHz TX Streams","capable-dfs":"DFS aware","capable-fast-bss-transition":"Fast BSS transition","capable-bss-transition":"BSS transition","capable-radio-measurement":"Radio measurement"};return t[e]?t[e]:e.replace(/[-_]/g," ").replace(/\b([a-z])/g,n=>n.toUpperCase())},mediumToBand(e){return this.formatMediumLabel(e)||e||""},formatMediumLabel(e){switch(e){case"wifi-24":return"2.4 GHz";case"wifi-5":return"5 GHz";case"wifi-6":return"6 GHz";case"ethernet":return"Ethernet";default:return e?e.replace(/[-_]/g," ").replace(/\b([a-z])/g,t=>t.toUpperCase()):""}},coerceNumber(e){if(e==null)return null;if(typeof e=="number")return Number.isFinite(e)?e:null;if(typeof e=="string"){const t=e.trim();if(!t)return null;const n=Number(t);return Number.isFinite(n)?n:null}if(typeof e=="object"&&e instanceof Number){const t=Number(e);return Number.isFinite(t)?t:null}return null},formatRateKbps(e){const t=this.coerceNumber(e);if(t===null)return"";if(Math.abs(t)>=1e3){const n=t/1e3,a=n>=100?0:n>=10?1:2;return`${n.toFixed(a)} Mbps`}return`${t} Kbps`},formatBytes(e){const t=this.coerceNumber(e);if(t===null)return"";if(t===0)return"0 B";const n=["B","KB","MB","GB","TB","PB"];let a=0,s=t;for(;s>=1024&&a<n.length-1;)s/=1024,a++;const i=s>=100||a===0?0:s>=10?1:2;return`${s.toFixed(i)} ${n[a]}`},formatDurationSeconds(e){const t=this.coerceNumber(e);if(t===null)return"";if(t<=0)return"just now";const n=Math.floor(t),a=[{label:"d",seconds:86400},{label:"h",seconds:3600},{label:"m",seconds:60},{label:"s",seconds:1}],s=[];let i=n;for(const r of a){if(i>=r.seconds){const o=Math.floor(i/r.seconds);s.push(`${o}${r.label}`),i%=r.seconds}if(s.length===2)break}return s.join(" ")},formatSignal(e,t){const n=this.coerceNumber(e);if(n!==null)return`${n} dBm`;const a=this.coerceNumber(t);return a!==null?`${a}`:e!=null&&e!==""?String(e):t!=null&&t!==""?String(t):""},formatClientCapabilities(e){return!e||typeof e!="object"?"":Object.entries(e).filter(([,n])=>n===!0||n==="true"||n===1||n==="1").map(([n])=>this.formatCapabilityLabel(n)).join(", ")},renderConnectedDevices(e){const t=this.connectedDevices;if(t){if(t.summary)if(!e.aps.length)t.summary.innerHTML='<p class="col-span-full text-xs text-gray-500">No access points reported.</p>';else{const n=e.aps.map(s=>{const i=e.wifi.filter(f=>f.apKey===s.key).length,r=e.ethernet.filter(f=>f.apKey===s.key).length,o=e.radios.filter(f=>f.apKey===s.key),d=m.escapeHtml(s.hostname||s.routerId||"Access point"),c=s.ip?m.escapeHtml(s.ip):"",p=s.mac?m.escapeHtml(s.mac):"",u=s.software?m.escapeHtml(s.software):"",g=typeof s.uptime=="number"?m.escapeHtml(m.formatUptime(s.uptime)):"",x=`<div class="text-xs text-gray-400">Devices: WiFi ${i} \xB7 Ethernet ${r}</div>`,l=o.map(f=>{const C=this.formatMediumLabel(f.medium)||f.band||f.standard,v=Number.isFinite(f.channel)?`Ch ${f.channel}`:"",E=[C,v].filter(Boolean).join(" \xB7 ");return E?`<span class="inline-flex items-center gap-1 text-[11px] font-medium bg-[#2d2d2d] text-gray-200 px-2 py-1 rounded-full border border-[#3e3e3e]">${m.escapeHtml(E)}</span>`:""}).filter(Boolean).join(""),y=l?`<div class="flex flex-wrap gap-2 pt-2">${l}</div>`:"";return`
                        <article class="rounded-lg border border-[#3a3a3a] bg-[#222222] p-4 space-y-1">
                            <div class="text-sm font-semibold text-[#f1f1f1]">${d}</div>
                            ${c?`<div class="text-xs text-gray-400">IP: ${c}</div>`:""}
                            ${p?`<div class="text-xs text-gray-400">MAC: ${p}</div>`:""}
                            ${u?`<div class="text-xs text-gray-500">Firmware: ${u}</div>`:""}
                            ${g?`<div class="text-xs text-gray-500">Uptime: ${g}</div>`:""}
                            ${x}
                            ${y}
                        </article>
                    `}).join(""),a=e.capabilities.length?`
                        <article class="rounded-lg border border-[#3a3a3a] bg-[#1b1b1b] p-4">
                            <div class="text-xs font-semibold uppercase tracking-wide text-[#e5e5e5] mb-2">Network features</div>
                            <div class="flex flex-wrap gap-2">
                                ${e.capabilities.map(s=>`<span class="inline-flex items-center gap-1 text-[11px] font-medium bg-[#2d2d2d] text-gray-200 px-2 py-1 rounded-full border border-[#3e3e3e]">${m.escapeHtml(s)}</span>`).join("")}
                            </div>
                        </article>
                    `:"";t.summary.innerHTML=n+a}t.ethernetCount&&(t.ethernetCount.textContent=`${e.ethernet.length} device${e.ethernet.length===1?"":"s"}`),t.ethernetList&&(e.ethernet.length?(t.ethernetEmpty?.classList.add("hidden"),t.ethernetList.innerHTML=e.ethernet.map(n=>this.renderConnectedDeviceCard(n)).join("")):(t.ethernetList.innerHTML="",t.ethernetEmpty?.classList.remove("hidden"))),t.wifiCount&&(t.wifiCount.textContent=`${e.wifi.length} device${e.wifi.length===1?"":"s"}`),t.wifiList&&(e.wifi.length?(t.wifiEmpty?.classList.add("hidden"),t.wifiList.innerHTML=e.wifi.map(n=>this.renderConnectedDeviceCard(n)).join("")):(t.wifiList.innerHTML="",t.wifiEmpty?.classList.remove("hidden")))}},renderConnectedDeviceCard(e){const t=e.name?m.escapeHtml(e.name):"",n=e.mac?m.escapeHtml(e.mac):"",a=e.ip&&e.ip!=="0.0.0.0"?m.escapeHtml(e.ip):"",s=m.escapeHtml(e.type||"Device"),i=t||n||"Unknown device",r=t?n:"",o=[];e.ap?.hostname&&o.push(m.escapeHtml(e.ap.hostname)),e.ap?.ip&&o.push(`IP ${m.escapeHtml(e.ap.ip)}`);const d=[];if(o.length&&d.push(`<div>${o.join(" \xB7 ")}</div>`),e.type==="WiFi"){const p=[this.formatMediumLabel(e.medium),e.standard,Number.isFinite(e.channel)?`Ch ${e.channel}`:""].filter(Boolean).map(u=>m.escapeHtml(u));p.length&&d.push(`<div>${p.join(" \xB7 ")}</div>`)}e.ap?.mac&&d.push(`<div>${m.escapeHtml(e.ap.mac)}</div>`);let c=[];return e.type==="WiFi"?c=[this.createDeviceTag("SSID",e.ssid),this.createDeviceTag("BSSID",e.bssid),this.createDeviceTag("Band",e.band||this.formatMediumLabel(e.medium)),this.createDeviceTag("Channel",Number.isFinite(e.channel)?`Ch ${e.channel}`:e.channel),this.createDeviceTag("Standard",e.standard),this.createDeviceTag("State",e.state),this.createDeviceTag("Signal",this.formatSignal(e.rssiDbm,e.signalStrength)),this.createDeviceTag("Downlink",this.formatRateKbps(e.downRateKbps)),this.createDeviceTag("Uplink",this.formatRateKbps(e.upRateKbps)),this.createDeviceTag("PHY",this.formatRate(e.phyRate)),this.createDeviceTag("RX",this.formatBytes(e.rxBytes)),this.createDeviceTag("TX",this.formatBytes(e.txBytes)),this.createDeviceTag("Vendor",e.vendor),this.createDeviceTag("Last seen",this.formatDurationSeconds(e.secondsSinceSeen)),this.createDeviceTag("Connected",this.formatDurationSeconds(e.connectedSeconds)),this.createDeviceTag("Capabilities",this.formatClientCapabilities(e.capabilities))]:c=[this.createDeviceTag("Port",e.port),this.createDeviceTag("PHY",this.formatRate(e.phyRate)),this.createDeviceTag("Vendor",e.vendor)],c=c.filter(Boolean),`
            <article class="rounded-lg border border-[#3a3a3a] bg-[#222222] p-4 space-y-3">
                <div class="flex flex-wrap justify-between gap-3">
                    <div>
                        <div class="text-xs font-semibold uppercase tracking-wide text-gray-400">${s}</div>
                        <div class="text-sm font-semibold text-[#f1f1f1]">${i}</div>
                        ${r?`<div class="text-xs text-gray-500">${r}</div>`:""}
                        ${a?`<div class="text-xs text-gray-500">IP: ${a}</div>`:""}
                    </div>
                    <div class="text-right text-[11px] text-gray-500">
                        ${d.join("")}
                    </div>
                </div>
                ${c.length?`<div class="flex flex-wrap gap-2">${c.join("")}</div>`:""}
            </article>
        `},createDeviceTag(e,t){if(t==null||t==="")return"";const n=Array.isArray(t)?t.filter(Boolean).join(", "):t;if(n==null||n==="")return"";const a=String(n);return!a.trim()&&a!=="0"?"":`<span class="inline-flex items-center gap-1 text-[11px] font-medium bg-[#2d2d2d] text-gray-200 px-2 py-1 rounded-full border border-[#3e3e3e]">${m.escapeHtml(e)}: ${m.escapeHtml(a)}</span>`},formatRate(e){const t=this.coerceNumber(e);if(t===null)return"";if(Math.abs(t)>=1e3){const a=t/1e3,s=a>=100?0:a>=10?1:2;return`${a.toFixed(s)} Gbps`}const n=Math.abs(t)>=10?0:1;return`${t.toFixed(n)} Mbps`},showNotification({title:e="Notification",message:t="",tone:n="info",duration:a=4e3}={}){if(!this.notificationRoot)return;const s=this.notificationRoot.querySelector(".toast-container");if(!s)return;const i=document.createElement("div");i.className=`toast toast--${n} pointer-events-auto`;const r=document.createElement("div");r.className="toast__content";const o=document.createElement("div");o.className="toast__title",o.textContent=e;const d=document.createElement("div");d.className="toast__message",d.textContent=t,r.appendChild(o),t&&r.appendChild(d);const c=document.createElement("button");c.className="toast__close",c.type="button",c.innerHTML="&times;",c.addEventListener("click",()=>{this.dismissNotification(i)}),i.appendChild(r),i.appendChild(c),s.appendChild(i),requestAnimationFrame(()=>{i.classList.add("show")});let p;return a>0&&(p=setTimeout(()=>this.dismissNotification(i),a)),{element:i,dismiss:()=>{p&&clearTimeout(p),this.dismissNotification(i)}}},dismissNotification(e){e&&(e.classList.remove("show"),setTimeout(()=>{e.remove()},250))},async openConfigDialog(){if(this.configDialog){this.configForm?.reset(),this.toggleConfigLoading(!0,"Loading..."),this.configDialog.classList.add("active");try{const e=await h.getConfig();this.populateConfigForm(e)}catch(e){console.error("Failed to load configuration:",e),this.showNotification({title:"Failed to load configuration",message:e.message||"Please try again shortly.",tone:"error"})}finally{this.toggleConfigLoading(!1)}}},closeConfigDialog(){this.configDialog&&(this.configDialog.classList.remove("active"),this.toggleConfigLoading(!1))},async submitConfigForm(e){if(e.preventDefault(),!this.configForm)return;const t={router_host:this.configInputs.routerHost?.value?.trim()||"",router_user:this.configInputs.routerUser?.value?.trim()||"",router_password:this.configInputs.routerPassword?.value||"",listen_host:this.configInputs.listenHost?.value?.trim()||"",listen_port:this.configInputs.listenPort?.value?.trim()||""};this.toggleConfigLoading(!0);const n=t.listen_host,a=t.listen_port;try{await h.checkListener(n,a)}catch(s){console.error("Listener availability check failed:",s),this.showNotification({title:"Listener Unavailable",message:s.message,tone:"error"}),this.toggleConfigLoading(!1);return}try{const s=await h.updateConfig(t);s?.config&&this.populateConfigForm(s.config);const i=`${n||"0.0.0.0"}:${a||"5000"}`;this.showNotification({title:"Configuration Saved",message:`Reload in progress. Access the dashboard at http://${i}/ once it comes back online.`,tone:"success"}),setTimeout(()=>this.closeConfigDialog(),4e3)}catch(s){console.error("Failed to update configuration:",s),this.showNotification({title:"Save Failed",message:s.message||"Your changes could not be saved.",tone:"error"})}finally{this.toggleConfigLoading(!1)}},populateConfigForm(e){e&&(this.configInputs.routerHost&&(this.configInputs.routerHost.value=e.router_host??""),this.configInputs.routerUser&&(this.configInputs.routerUser.value=e.router_user??""),this.configInputs.routerPassword&&(this.configInputs.routerPassword.value=e.router_password??""),this.configInputs.listenHost&&(this.configInputs.listenHost.value=e.listen_host??""),this.configInputs.listenPort&&(this.configInputs.listenPort.value=e.listen_port??""))},toggleConfigLoading(e,t="Saving..."){this.configSaveBtn&&(this.configSaveBtn.disabled=e,this.configSaveBtn.textContent=e?t:"Save Changes"),this.configCancelBtn&&(this.configCancelBtn.disabled=e,this.configCancelBtn.classList.toggle("opacity-60",e),this.configCancelBtn.classList.toggle("cursor-not-allowed",e))},startPolling(e){this.pollingInterval&&clearInterval(this.pollingInterval),this.pollingInterval=setInterval(async()=>{try{await this.loadData(),await this.loadDailyUsage()}catch(t){console.error("Polling error:",t)}},e)}};async function N(){const e=document.getElementById("resetIp"),t=document.getElementById("rebootBtn");e&&(e.disabled=!0,e.classList.add("opacity-60","cursor-not-allowed")),t&&(t.disabled=!0,t.classList.add("opacity-60","cursor-not-allowed"));const n=w.showNotification({title:"Renewing WAN IP",message:"Stand by while we fetch a fresh public IP...",tone:"info",duration:0});try{const s=(await h.getPreloginStatus())?.wan_conns?.[0]?.ipConns?.[0]?.ExternalIPAddress||"unknown";await h.setApnInternet("internet"),await new Promise(d=>setTimeout(d,1e3)),await h.setApnInternet("xlunlimited"),await new Promise(d=>setTimeout(d,1e3));let i=null,r=0;const o=30;for(;!i&&r<o;){r++;const c=(await h.getPreloginStatus())?.wan_conns?.[0]?.ipConns?.[0]?.ExternalIPAddress||null;if(c&&c!==s){i=c;break}await new Promise(p=>setTimeout(p,1e3))}i?w.showNotification({title:"WAN IP Renewed",message:`New public IP acquired: ${i}.`,tone:"success"}):w.showNotification({title:"Renewal Timed Out",message:"Could not detect a new IP after multiple attempts. Please try again later.",tone:"error"})}catch(a){console.error("Error during IP reset:",a),w.showNotification({title:"Renew Failed",message:a.message||"Unexpected error while renewing WAN IP.",tone:"error"})}finally{n&&n.dismiss&&n.dismiss(),e&&(e.disabled=!1,e.classList.remove("opacity-60","cursor-not-allowed")),t&&(t.disabled=!1,t.classList.remove("opacity-60","cursor-not-allowed"))}}async function H(){const e=document.getElementById("rebootBtn");e&&(e.disabled=!0,e.classList.add("opacity-60","cursor-not-allowed"));const t=w.showNotification({title:"Rebooting Router",message:"Sending reboot command. The device will be unavailable momentarily.",tone:"info",duration:0});try{await h.doReboot(),w.showNotification({title:"Reboot Command Sent",message:"Router is restarting. Please allow 1-2 minutes before reconnecting.",tone:"success"})}catch(n){console.error("Error during reboot:",n),w.showNotification({title:"Reboot Failed",message:n.message||"Unable to reboot the device.",tone:"error"})}finally{t&&t.dismiss&&t.dismiss(),e&&(e.disabled=!1,e.classList.remove("opacity-60","cursor-not-allowed"))}}async function k(){const e=document.getElementById("smsDialog");e&&(e.classList.add("active"),$())}function $(){const e=document.getElementById("smsDialog"),t=document.getElementById("smsList"),n=document.getElementById("smsTotalCount"),a=document.getElementById("smsUnreadCount"),s=document.getElementById("smsBadge"),i=document.getElementById("smsDeleteAllBtn");if(e.classList.add("active"),!m.smsData)return;i&&!i.dataset.defaultContent&&(i.dataset.defaultContent=i.innerHTML);const r=()=>{t.innerHTML='<p class="text-xs text-gray-400 text-center border border-dashed border-[#3a3a3a] rounded-lg px-3 py-4">No SMS messages.</p>'},o=()=>{const c=m.smsData.length,p=m.smsData.filter(u=>u.SMSUnread).length;if(n.textContent=c,a.textContent=p,i){const u=c>0;i.disabled=!u,i.classList.toggle("hidden",!u)}return s&&(p>0?(s.textContent=p,s.classList.remove("hidden")):(s.textContent="0",s.classList.add("hidden"))),{totalCount:c,unreadCount:p}},d=o();if(t.innerHTML="",d.totalCount===0){r();return}m.smsData.forEach(c=>{const p=document.createElement("div");p.className=`p-3 rounded-lg border ${c.SMSUnread?"bg-blue-900 border-blue-700":"bg-[#282828] border-gray-600"}`,p.dataset.smsid=c.SMSID;const u=document.createElement("div");u.className="flex justify-between items-start gap-3";const g=document.createElement("div");g.className=`flex-1 ${c.SMSUnread?"cursor-pointer":""}`,g.innerHTML=`
            <p class="font-semibold text-white">${m.escapeHtml(c.SMSSender||"Unknown")}</p>
            <p class="text-gray-400 text-sm mt-1">${new Date(c.SMSDateTime).toLocaleString()}</p>
            <p class="text-gray-300 mt-2 whitespace-pre-wrap break-words">${m.escapeHtml(c.SMSContent||"")}</p>
        `;const x=document.createElement("div");x.className="flex flex-col items-end gap-2";const l=document.createElement("button");l.type="button",l.className="inline-flex items-center gap-2 rounded-md border border-red-500/60 px-3 py-1.5 text-xs font-semibold text-red-200 transition hover:bg-red-500/10 focus:outline-none focus:ring-2 focus:ring-red-500/40 disabled:cursor-not-allowed disabled:opacity-60",l.innerHTML=`
            <span class="flex items-center gap-1">
                <i class="fas fa-times text-xs"></i>
            </span>
        `,x.appendChild(l),u.appendChild(g),u.appendChild(x),p.appendChild(u),t.appendChild(p),c.SMSUnread&&g.addEventListener("click",async()=>{try{await h.setSmsState(c.SMSID,!1),c.SMSUnread=!1,p.classList.remove("bg-blue-900","border-blue-700"),p.classList.add("bg-[#282828]","border-gray-600"),g.classList.remove("cursor-pointer"),o(),w.showNotification({title:"SMS marked as read",message:c.SMSSender?`From ${c.SMSSender}`:void 0,tone:"success"})}catch(y){console.error("Error marking SMS as read:",y)}}),l.addEventListener("click",async y=>{if(y.stopPropagation(),!l.disabled){A(l,!0,{loadingText:"Deleting\u2026",spinnerColor:"text-red-200"});try{await h.deleteSms(c.SMSID),m.smsData=m.smsData.filter(C=>C.SMSID!==c.SMSID),p.remove();const{totalCount:f}=o();f===0&&r(),w.showNotification({title:"SMS deleted",tone:"success"})}catch(f){console.error("Error deleting SMS:",f),w.showNotification({title:"Failed to delete SMS",message:f.message||"Unable to delete message.",tone:"error"})}finally{l.isConnected&&A(l,!1)}}})}),i&&(i.onclick=async c=>{if(c.preventDefault(),!i.disabled&&window.confirm("Delete all SMS messages? This cannot be undone.")){A(i,!0,{loadingText:"Deleting\u2026",spinnerColor:"text-red-200"});try{await h.deleteSms([],{deleteAll:!0}),m.smsData=[],r(),o(),w.showNotification({title:"All SMS deleted",tone:"success"})}catch(p){console.error("Error deleting all SMS:",p),w.showNotification({title:"Failed to delete all SMS",message:p.message||"Unable to delete all messages.",tone:"error"})}finally{A(i,!1),m.smsData.length===0&&i.classList.add("hidden")}}})}function P(){document.getElementById("smsDialog").classList.remove("active")}function R(){const e=document.getElementById("ledSwitch");if(!e)return;const t=e.parentElement,n="nokia-led-switch-state",a=o=>{e.disabled=o,t&&(t.classList.toggle("pointer-events-none",o),t.classList.toggle("opacity-60",o))};try{const o=localStorage.getItem(n);o!==null&&(e.checked=o==="true")}catch{}let s=!1;const i=o=>{if(typeof o=="boolean")return o;if(typeof o=="number")return o!==0;if(typeof o=="string"){const d=o.trim().toLowerCase();if(!d)return!1;if(["true","on","enabled","enable","yes","1"].includes(d))return!0;if(["false","off","disabled","disable","no","0"].includes(d))return!1;const c=Number(o);return!Number.isNaN(c)&&c!==0}return!!o},r=o=>{if(!o||typeof o!="object")return null;if(typeof o.enabled=="boolean")return o.enabled;if(typeof o.enabled=="number")return o.enabled!==0;if(typeof o.status_led<"u"&&typeof o.signal_led<"u")return i(o.status_led)&&i(o.signal_led);const d=o.LEDGlobalSts;if(d&&typeof d=="object"){const c=i(d.X_ALU_COM_StatusLED_Enable),p=i(d.X_ALU_COM_SignalLED_Enable);if(typeof d.X_ALU_COM_StatusLED_Enable<"u"||typeof d.X_ALU_COM_SignalLED_Enable<"u")return c&&p}return null};(async()=>{s=!0,a(!0);try{const o=await h.getCurrentLedState(),d=r(o);if(d!==null){e.checked=d;try{localStorage.setItem(n,String(d))}catch{}}}catch(o){console.error("Failed to fetch current LED state:",o)}finally{a(!1),s=!1}})(),e.addEventListener("change",async()=>{if(s)return;const o=e.checked;s=!0,a(!0);try{await h.setLedState(o);try{localStorage.setItem(n,String(o))}catch{}w.showNotification({title:"LEDs Updated",message:o?"Device LEDs enabled.":"Device LEDs disabled.",tone:"success"})}catch(d){console.error("Failed to update LED state:",d),e.checked=!o;try{localStorage.setItem(n,String(e.checked))}catch{}w.showNotification({title:"LED Update Failed",message:d.message||"Unable to change LED state.",tone:"error"})}finally{a(!1),s=!1}})}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("resetIp");e&&e.addEventListener("click",N);const t=document.getElementById("refreshIp");t&&t.addEventListener("click",N);const n=document.getElementById("rebootBtn");n&&n.addEventListener("click",H);const a=document.getElementById("smsIcon"),s=document.getElementById("smsCloseDialog");a&&a.addEventListener("click",k),s.addEventListener("click",P),[document.getElementById("closeDialog"),document.getElementById("closeDialogBtn")].forEach(r=>{r&&r.addEventListener("click",()=>{const o=document.getElementById("infoDialog");o&&o.classList.remove("active")})}),R()});const F={init(){if(!this.ensureElementsExist()){console.error("Required elements for ExpirationManager not found");return}this.setupEventListeners(),this.loadAndUpdateExpiration()},ensureElementsExist(){return["dataExpired","expirationDialog","closeExpirationDialog","extend30Days","saveExpirationDate","expirationDate"].every(t=>document.getElementById(t)?!0:(console.warn(`Element with ID ${t} not found`),!1))},setupEventListeners(){const e=document.getElementById("dataExpired"),t=document.getElementById("closeExpirationDialog"),n=document.getElementById("extend30Days"),a=document.getElementById("saveExpirationDate");e.style.cursor="pointer",e.addEventListener("click",()=>this.showExpirationDialog()),t.addEventListener("click",()=>this.hideExpirationDialog()),n.addEventListener("click",()=>this.extend30Days()),a.addEventListener("click",()=>this.saveExpirationDate())},async loadAndUpdateExpiration(){try{const e=await h.getDataExpired();this.updateExpirationDisplay(e)}catch(e){console.error("Error loading expiration date:",e),this.updateExpirationDisplay(0)}},showExpirationDialog(){const e=document.getElementById("expirationDialog"),t=document.getElementById("expirationDate"),n=this.getCurrentExpirationDate();n?t.valueAsDate=n:t.value="",e.classList.add("active")},hideExpirationDialog(){document.getElementById("expirationDialog").classList.remove("active")},async extend30Days(){const e=document.getElementById("expirationDate");let t=new Date;t.setDate(t.getDate()+30),e.valueAsDate=t;const n=e.valueAsDate,a=Math.floor(n.getTime()/1e3);try{await h.setDataExpired(a),this.updateExpirationDisplay(a),this.hideExpirationDialog()}catch(s){console.error("Error saving expiration date:",s),alert("Failed to save expiration date: "+s.message)}},async saveExpirationDate(){const e=document.getElementById("expirationDate");if(!e.value){alert('Please select a date or click "Extend 30 Days"');return}const t=e.valueAsDate,n=Math.floor(t.getTime()/1e3);try{await h.setDataExpired(n),this.updateExpirationDisplay(n),this.hideExpirationDialog()}catch(a){console.error("Error saving expiration date:",a),alert("Failed to save expiration date: "+a.message)}},getCurrentExpirationDate(){const t=document.getElementById("dataExpired").dataset.expirationTimestamp;return t?new Date(parseInt(t)*1e3):null},updateExpirationDisplay(e){const t=document.getElementById("dataExpired");if(!e||e<=0){t.textContent="Not set",t.className="font-semibold text-xs text-gray-400",t.dataset.expirationTimestamp="";return}const n=new Date(e*1e3),s=n-new Date,i=Math.ceil(s/(1e3*60*60*24));t.dataset.expirationTimestamp=e;const r=n.toLocaleDateString("id-ID",{day:"numeric",month:"short"});if(s<=0)t.textContent="Expired",t.className="font-semibold text-xs text-red-500";else{let o="text-white";i<=3?o="text-red-500":i<=7?o="text-yellow-500":o="text-green-500",t.textContent=`${r} (${i} days remaining)`,t.className=`font-semibold text-xs ${o}`}}};document.addEventListener("DOMContentLoaded",()=>w.init())});return U();})();
