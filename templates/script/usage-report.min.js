var NokiaReport=(()=>{var u=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var h=u(()=>{const g={elements:{},init(){this.cacheElements(),this.renderCurrentYear(),this.loadUsage()},cacheElements(){this.elements={tableBody:document.getElementById("usageReportTableBody"),loadingRow:document.getElementById("usageReportLoading"),emptyRow:document.getElementById("usageReportEmpty"),errorRow:document.getElementById("usageReportError"),totalDownload:document.getElementById("reportTotalDownload"),totalUpload:document.getElementById("reportTotalUpload"),period:document.getElementById("reportPeriod")}},renderCurrentYear(){const t=document.getElementById("currentYear");t&&(t.textContent=new Date().getFullYear())},async loadUsage(){this.showState("loading");try{const t=await fetch("/api/daily_usage");if(!t.ok)throw new Error(`Request failed with status ${t.status}`);const e=await t.json();this.renderTable(e)}catch(t){console.error("Failed to load usage report:",t),this.showState("error")}},showState(t){const{loadingRow:e,emptyRow:o,errorRow:a}=this.elements;e&&e.classList.toggle("hidden",t!=="loading"),o&&o.classList.toggle("hidden",t!=="empty"),a&&a.classList.toggle("hidden",t!=="error")},renderTable(t){const e=Array.isArray(t?.daily_data)?t.daily_data:[],{tableBody:o}=this.elements;if(!o)return;if(o.querySelectorAll('tr[data-row="usage"]').forEach(r=>r.remove()),e.length===0){this.showState("empty"),this.updateSummary(null,null,t);return}this.showState("data");const a=e.map(r=>{const d=this.formatDate(r.date),i=r.download?.formatted??"0 B",c=r.upload?.formatted??"0 B",m=r.combined?.formatted??"0 B",l=r.combined?.percentage,p=typeof l=="number"&&Number.isFinite(l)?`${l.toFixed(1)}%`:"0%";return`
          <tr data-row="usage">
            <td class="px-4 py-3 whitespace-nowrap">${this.escapeHtml(d)}</td>
            <td class="px-4 py-3 text-right text-blue-300">${this.escapeHtml(i)}</td>
            <td class="px-4 py-3 text-right text-green-300">${this.escapeHtml(c)}</td>
            <td class="px-4 py-3 text-right font-semibold">${this.escapeHtml(m)}</td>
            <td class="px-4 py-3 text-right text-gray-400">${this.escapeHtml(p)}</td>
          </tr>
        `}).join("");o.insertAdjacentHTML("beforeend",a);const s=e[0]?.date??null,n=e[e.length-1]?.date??s;this.updateSummary(s,n,t)},updateSummary(t,e,o){const{totalDownload:a,totalUpload:s,period:n}=this.elements;a&&(a.textContent=o?.total_usage?.download??"0 B"),s&&(s.textContent=o?.total_usage?.upload??"0 B"),n&&(t?!e||e===t?n.textContent=this.formatDate(t):n.textContent=`${this.formatDate(e)} \u2013 ${this.formatDate(t)}`:n.textContent="\u2014")},formatDate(t){if(!t)return"\u2014";const e=new Date(`${t}T00:00:00Z`);return Number.isNaN(e.getTime())?t:e.toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"})},escapeHtml(t){return t==null?"":String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}};document.addEventListener("DOMContentLoaded",()=>g.init())});return h();})();
